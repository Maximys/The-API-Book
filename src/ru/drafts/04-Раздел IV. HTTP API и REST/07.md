### Работа с серверными ошибками в HTTP API

**Ошибки `5xx`** индицируют, что клиент, со своей стороны, выполнил запрос правильно, и проблема заключается в сервере. Для клиента, по большому счёту, важно только то, имеет ли смысл повторять запрос и, если да, то через какое время. Таким образом, кодов `500 Internal Server Error` и `503 Service Unavailable` было бы достаточно (второй код указывает, что отказ в обслуживании имеет разовый характер и есть смысл автоматически повторить запрос) — или можно вовсе ограничиться одним из них с опциональным заголовком `Retry-After`. Для целей мониторинга состояния системы имеет определённый смысл использовать другие коды (`502` и `504` для индикации проблем с гейтвеями) но, из общих соображений, унифицированный интерфейс (когда внутренняя информация о серверных ошибках передаётся в виде метаданных и используется для диагностики так же, как и для клиентских ошибок) был бы более консистентным и удобным в настройке — с точностью до того, что внешний гейтвей должен её удалить, чтобы не выдавать внутренние ошибки внешнему наблюдателю.

Разумеется, серверные ошибки также должны содержать информацию для разработчика и для конечного пользователя системы с описанием действий, которые необходимо выполнить при получении ошибки, и вот здесь мы вступаем на очень скользкую территорию.

Современная практика реализации HTTP-клиентов такова, что безусловно повторяются только немодифицирующие (`GET`, `HEAD`, `OPTIONS`) запросы. В случае модифицирующих запросов *разработчик должен написать код*, который повторит запрос — и для этого разработчику нужно очень внимательно прочитать документацию к API.

*Теоретически* идемпотентные методы `PUT` и `DELETE` можно вызывать повторно. Практически, однако, ввиду того, что многие разработчики упускают требование идемпотентности этих методов, фреймворки работы с HTTP API по умолчанию перезапросов модифицирующих методов, как правило, не делают; перезапросов потенциально неидемпотентных `POST` и `PATCH` (а также частичного `PUT`) фреймворки не допускают почти никогда.